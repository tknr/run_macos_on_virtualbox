seshat — Linux,MacOS,Windows

【かんたん】Windows上のVirtualBoxでmacOS
Big Surが動く
seshat

2021年4月30日

はじめに
仮想環境のMacが欲しいと思うときってどんな時でしょうか。
実験的なことをやってみたいが、失敗するとMac環境を壊してしまう
あきるまで徹底的にmacOSをいじくりまわしたい
もし失敗したときに、かんたんに失敗前の状態に戻したい
macOSを使っているところをみんなに見せたい
動機はさまざまですが、そのような場合、Windows上にVirtualBoxでMac環境
を構築してしまうのも選択肢の一つといえます。
仮想環境なのでホストマシンのスペックが高くても、実マシンと同じという
わけにはいきません。GPUを使用するAIの実行や動画編集には向かないでし
ょう。しかし、活用できるシーンは多くあると思います。
仮想イメージファイルをバックアップしておけば、時間を巻き戻せるのも魅
力です。
ぜひ、本稿を参考にしてMacにチャレンジしてみてください。

【あくまで参考】PCに必要なスペックとは
CPU①：インテルかAMD
CPU②：論理コア数４以上（仮想マシンに2コア必要）
メモリ：8GB以上（仮想マシンに4GB必要）

ストレージ：空き容量が60GB以上、推奨サイズは80GB以上

仮想化の準備をしよう
Big SurのISOイメージを手に入れよう
仮想マシンを構築するためのインストール元となるISOイメージをこちらのリ
ンクからダウンロードします。

Macをお持ちの方は…
Macをお持ちの方は、MacでBig Surをダウンロードしたほうが最新のイメー
ジが入手できますし、早いかもしれません。その場合、ISOイメージに変換す
る必要がありますが、それらの手順は省略します。

PCのBIOSから仮想化の設定をしよう
お使いのPCのBIOS等から「仮想化」を有効化してください。 具体的な設定
方法はPCによって異なるため、メーカの説明書やWebの情報を参照くださ
い。

VirtualBoxをすでにお使いの方への注意事項
VirtualBoxをすでにお使いの方は、必ずバックアップを取ってから試すことを
お勧めします。

VirtualBoxをインストールしよう
VirtualBoxのバージョン6をインストールします。本稿の執筆時点でのバージ
ョンは6.1.20です。

ここでは、VirtualBoxのインストール手順の説明を省略し、インストール後を
前提として説明します。

新しい仮想マシンの器を作ろう

第1段階の設定を行う
仮想マシンの設定は2段階に分けて行います。まず、第1段階目の設定をこれ
から実施します。
VirtualBoxを起動し、Oracle VM VirtualBox Manager上部にある青い[新規]ア
イコンをクリックします。

これから作成する仮想マシンは、仮想マシン個々その「名前」で識別されま
す。名前は任意で決められますが、ここでは「Big Sur」としました。
続いて「タイプ」を「Mac OS Ⅹ」とします。バージョンは「Mac OS Ⅹ(64bit)」を選択します。
最後に「次へ」をクリックします。

「仮想マシンの作成」画面、「メモリーサイズ」では、ホストマシンのリソ
ースに応じたメモリサイズを指定します。4GB以上を指定する必要がありま
す。私は8GBとしました。
「次へ」をクリックします。

「ハードディスク」はデフォルトのままでよいでしょう。
「作成」をクリックします。

「ハードディスクのファイルタイプ」はVHD（Virtual Hard Disk）に変更しま
す。
[次へ]をクリックします。

「物理ハードディスクにあるストレージ」では、「可変サイズ」のままとし
ます。ストレージの容量は動的に割り当てられます。
［次へ］をクリックします。

「ファイルの場所とサイズ」では、仮想ディスク最大サイズを入力します。
60GB以上で、PCのディスク（SSD）空き領域に応じたサイズとします。こ
こでは約120GBとしました。

ここで[ハードウェアをカスタマイズ]をクリックし、「ハードウェア」画面
を表示します。
[作成]をクリックして、第1段階の設定作業を完了します。

第2段階目の設定を行う
「Oracle VM VirtualBoxマネージャ」の上部にある黄色の「設定」アイコンを
クリックし、設定画面を開きます。

設定画面左のメニュー一覧から[システム]を選択し、「マザーボード」タブ
の「起動順序」にある「フロッピー」のチェックを外します。

次に「プロセッサー」タブに移ります。
CPU（プロセッサー）は2個以上を割り当てます。可能であれば、ホストマシ
ンの論理CPU数の2分の1程度を割り当てるとよいでしょう。

左から「ディスプレイ」を選択し、「スクリーン」タブの「ビデオメモリ
ー」を128MBに変更します。

次はmacOSのISOファイルを読み込むための設定です。
①左ペインの「ストレージ」を選択し、②「ストレージデバイス」欄の
「空」のDVDをクリックします。
続いて③右側の「属性」にある「光学ドライブ」右端の青いDVDアイコンを
クリックします。するとメニューが表示されるので、④「ディスクファイル
を選択」をクリックします。
次に表示される「仮想光学ディスクファイルを選択してください」画面でBig
SurのISOファイルを選択します。

これで中央ペインのDVDアイコンにISOファイル名が表示されました。
[OK]をクリックします。

VirtualBoxマネージャにに仮想マシン「Big Sur」のスタートボタンが表示さ
れますが、まだ起動しないでください。

ここで必ず、VirtualBoxを終了しておきます。VirtualBoxが動作していると、
この後の作業が反映されません。

「コード」を実行しよう
CPUによってコードが違います
これから、VirtualBox上でmacOSがインストールできるようにするための
「コード」と呼ばれるコマンドをコマンドプロンプトから実行します。
コードは2種類あります。PCのプロセッサがインテル系のCPUか、AMD系の
CPUかで実行すべきコードが異なります。
次のコードはインテルCPU向けのコードです。
1.
2.
3.
4.
5.

6.

7.

cd "C:\Program Files\Oracle\VirtualBox\"
VBoxManage.exe modifyvm "Big Sur" --cpuidset 00000001 000106
00100800 0098e3fd bfebfbff
VBoxManage setextradata "Big Sur"
"VBoxInternal/Devices/efi/0/Config/DmiSystemProduct" "iMac19,
VBoxManage setextradata "Big Sur"
"VBoxInternal/Devices/efi/0/Config/DmiSystemVersion" "1.0"
VBoxManage setextradata "Big Sur"
"VBoxInternal/Devices/efi/0/Config/DmiBoardProduct" "MacAA95B1DDAB278B95"
VBoxManage setextradata "Big Sur"
"VBoxInternal/Devices/smc/0/Config/DeviceKey"
"ourhardworkbythesewordsguardedpleasedontsteal(c)AppleCompute
VBoxManage setextradata "Big Sur"
"VBoxInternal/Devices/smc/0/Config/GetKeyFromRealSMC" 1

以下のコードがAMD向けのコードです。
1.
2.
3.
4.
5.

6.

cd "C:\Program Files\Oracle\VirtualBox\"
VBoxManage.exe modifyvm "Big Sur" --cpu-profile "Intel Core
6700K"
VBoxManage setextradata "Big Sur"
"VBoxInternal/Devices/efi/0/Config/DmiSystemProduct" "iMac19,
VBoxManage setextradata "Big Sur"
"VBoxInternal/Devices/efi/0/Config/DmiSystemVersion" "1.0"
VBoxManage setextradata "Big Sur"
"VBoxInternal/Devices/efi/0/Config/DmiBoardProduct" "MacAA95B1DDAB278B95"
VBoxManage setextradata "Big Sur"
"VBoxInternal/Devices/smc/0/Config/DeviceKey"
"ourhardworkbythesewordsguardedpleasedontsteal(c)AppleCompute

7.

VBoxManage setextradata "Big Sur"
"VBoxInternal/Devices/smc/0/Config/GetKeyFromRealSMC" 1

コードの仮想マシン名を変更しよう
ここで上記のコードは、仮想マシンの名前を「Big Sur」と命名している場合
に対応しています。なので、上記のコードを実行する前に、コードの中の
「”Big Sur”」という文字列を、あなたがつけた名前に変更する必要がありま
す。もちろん、最初から「Big Sur」にしている方は、次の作業は不要です。
「メモ帳」を開きます。開いたメモ帳に、上記のコードをコピペします。次
に「Big Sur」の部分をマウスで選択しておきます。6カ所あるうちの1カ所だ
けでOKです。

メニューバーの[編集]＞[置換]を選択。

「置換」ダイアログが開きます。
①検索する文字列が「Big Sur」になっていることを確かめます。
②置換後の文字列を入力します。ここでは例として、あなたの仮想マシンの
名前が「macOS 11 BigSur」である場合とします。
③[すべて置換]をクリックします。

一括変換後のメモ帳です。

いよいよコードを実行しよう
上記のコードを1行ずつ実行します。
まず、コマンドプロンプトを管理者モードで開きます。

メモ帳等からコードをコマンドプロンプトにコピペし、1行ずつコマンドを実
行します。くれぐれも、CPUの種類を間違えないようにしましょう。

これでようやく、VirtualBoxにmacOSをインストールする準備ができまし
た。

Big Surをインストールしよう
MacOSのインストールと設定
ここで再度、VirtualBoxを起動し、Big Surのインストールと設定を行いま
す。ここまでの作業が正しければ、アップルマークが表示されて、インスト
ーラが起動するはずです。
左ペインから仮想マシン名を選択し、上部の緑色の起動アイコンをクリック
します。

「起動ハードディスクを選択」画面が表示された場合は、「BigSur.ISO」
等、ISOイメージファイルを選択します。
[起動]をクリックします。
はたしてアップルマークは出てくるのでしょうか？

とてもドキドキする瞬間です。アップルマークが表示されました。

ここからがインストールの手続きです。
「日本語」を選択します。

この作業はわかりにくいところかもしれません。
おおまかに次の作業を行います。
1. ディスクユーティリティで空のインストールメディアを作成、
2. OSをインストール

まず、[ディスクユーティリティ」を選択して[続ける]をクリックします

空のドライブを作成するため、以下の手順を行います。
1. 左の[VBOX HARDDISK Media]を選択
2. 右上の[消去]をクリック

ここがわかりにくいところですが、これからドライブを「消去」し、新しい
空のドライブを作成します。その新しいドライブ名を指定します。
私は「appledisk」としました。名称は任意で決められます。デフォルトの
「名称未設定」のままでもかまいません。
名前を入力したら、［消去］をクリックします。

今回、下記のようなエラーが発生しました。「致命的でないエラー」という
ことで、[OK]をクリックして継続して問題なさそうです。

上記メッセージが出た場合ですが、仮想マシンが一時停止するようなので、
一時停止を解除して仮想マシンを継続実行させます。VirtualBoxの[仮想マシ
ン]＞[一時停止]をクリックします。

新しいドライブの作成が完了したので、[完了]をクリック。

最上部の［ディスクユーティリティ］メニューから［ディスクユーティリテ
ィを終了］。

[macOS Big Surインストール]を選択し、[続ける]をクリック。

[続ける]をクリックします。

①[同意する]をクリックし、さらにポップアップ画面の②[同意する]をクリッ
ク。

先ほど作成した空のディスクドライブが表示されるでしょう。①ドライブを
選択し、②[続ける]をクリックします。

インストールが開始されます。PCのスペックによりますが、ここから次の画
面が出るまで、30分以上かかる場合があります。

「日本」を選択して[続ける]をクリックします。

ここからはお好みに応じた設定やカスタマイズが選べます。ご参考までに私
の選択結果をお伝えします。
[続ける]をクリック。

[今はしない]をクリック。

[続ける]をクリック。

[今はしない]をクリック。

私は[あとで設定]をクリックしました。

[スキップ]をクリック。

[同意する]をクリック。

さらに[同意する]。

フルネーム、アカウント名、パスワードを入力して[続ける]。

[続ける]をクリック。

[続ける]をクリック。

[あとで設定]をクリック。

「”Siriに頼む”を有効にする」のチェックをはずして無効にし、[続ける]。

外観モードを選択して[続ける]。

設定を反映中？

いよいよ最後の設定です。
ここでキーボードの設定を行います。
[続ける]をクリックし、画面に従って操作ください。

ようやく設定が完了し、めでたくmacOS 11 Big Surが使えるようになりまし
た。

おわりに
VirtualBoxによる、macOSの仮想化のご紹介でした。これまで、VMwareによ
るmacOS仮想化の記事も紹介してきましたが、VirtualBoxにはスナップショ
ットなど、VirtualBoxならではの便利な機能があるため、VirtualBoxのファン
の方も多くいると思います。
そのようなみなさまもぜひ、良きMacライフを楽しんでいただければと思い
ます。

ご参考まで
VMwareの事例ですが、動画での紹介です。よければどうぞ。

VirtualBoxの上でmacOS Big Surを試してみたい方は以下の記事を参考にして
みてください。

【かんたん】Windows上のVirtualBoxでmacOS Big Sur
が動く
はじめに 仮想環境のMacが欲しいと思うときってどんな時でしょうか。 実験的なこと
をやってみたいが、失敗するとMac環境を壊してしまう あきるまで徹底的にmacOSを
いじくりまわしたい もし失敗したときに、かんたんに失敗 … 続きを読む
seshat

seshat, Proudly powered by WordPress.

